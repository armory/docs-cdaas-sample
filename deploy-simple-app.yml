version: v1
kind: kubernetes
application: sample-application
# Map of Application Targets to which we are deploying
targets:
  # This in the name of an application target, underneath it are its configuration
  my-local-cluster:
    # the name of an agent configured account. Agent Name can be found at https://console.cloud.armory.io/configuration > Agents
    account: aimeeu-local
    namespace: armory-sample-application
    # This is the name of the strategy to use when deploying.
    strategy: mycanary
# The list of manifests to deploy
manifests:
  # This will read all yaml|yml files in a dir and deploy all manifests in that directory to all targets, or their specified target.
  - path: manifests/sample-namespace.yml
    targets: [my-local-cluster]
  - path: manifests/demo-app.yml
# The map of strategies, a deployment target will reference one of these
strategies:
  # this is the name for the strategy
  mycanary:
    # This specifies the strategy type
    canary:
      # List of canary steps
      steps:
        # there are multiple step types. setWeight changes what percentage of traffic reaches the new version.
        - setWeight:
            weight: 25
        - pause:
            duration: 30
            unit: seconds
        - setWeight:
            weight: 50
        - pause:
            duration: 30
            unit: seconds
        - setWeight:
            weight: 100
