---
# deployment.yaml
version: v1
kind: kubernetes
application: reviews
targets:
  dev:
    account: aimeeu-local
    namespace: istiodemo
    strategy: strategy1
manifests:
  - path: manifests/reviews-v1.yaml
strategies:
  strategy1:
    canary:
      steps:
        - setWeight:
            weight: 10
        - pause:
            untilApproved: true
        - setWeight:
            weight: 57
        - pause:
            untilApproved: true
trafficManagement:
  - targets: ["dev"]
    istio:
      - virtualService:
          name: reviews-route # virtualService.metadata.name
          httpRouteName: reviews-http-route # virtualService.http.route[].name abstraction
        destinationRule: # OPTIONAL (if only one destination exists on the service) virtualService.http.route[].destination/destinationRule abstraction
          name: reviews-destination #destinationRule.metadata.name
          activeSubsetName: stable # OPTIONAL (if only 1 active subset on DR)- virtualService.http.route[].destinations[0].subset
          canarySubsetName: canary
